<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>User Guide · Vlasiator.jl</title><meta name="title" content="User Guide · Vlasiator.jl"/><meta property="og:title" content="User Guide · Vlasiator.jl"/><meta property="twitter:title" content="User Guide · Vlasiator.jl"/><meta name="description" content="Documentation for Vlasiator.jl."/><meta property="og:description" content="Documentation for Vlasiator.jl."/><meta property="twitter:description" content="Documentation for Vlasiator.jl."/><meta property="og:url" content="https://henry2004y.github.io/Vlasiator.jl/manual/"/><meta property="twitter:url" content="https://henry2004y.github.io/Vlasiator.jl/manual/"/><link rel="canonical" href="https://henry2004y.github.io/Vlasiator.jl/manual/"/><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../search_index.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script><link href="../democards/nocoverlisttheme.css" rel="stylesheet" type="text/css"/></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../"><img src="../assets/logo.png" alt="Vlasiator.jl logo"/></a><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../">Home</a></li><li class="is-active"><a class="tocitem" href>User Guide</a><ul class="internal"><li><a class="tocitem" href="#Common-physical-constants"><span>Common physical constants</span></a></li><li><a class="tocitem" href="#Loading-VLSV-data"><span>Loading VLSV data</span></a></li><li><a class="tocitem" href="#Computing-derived-quantities"><span>Computing derived quantities</span></a></li><li><a class="tocitem" href="#Plotting"><span>Plotting</span></a></li><li><a class="tocitem" href="#Appending-to-VLSV"><span>Appending to VLSV</span></a></li><li><a class="tocitem" href="#Converting-to-VTK"><span>Converting to VTK</span></a></li><li><a class="tocitem" href="#Tracking-log-files"><span>Tracking log files</span></a></li><li><a class="tocitem" href="#Examples"><span>Examples</span></a></li></ul></li><li><a class="tocitem" href="../examples/">Examples</a></li><li><a class="tocitem" href="../python/">Calling from Python</a></li><li><a class="tocitem" href="../gallery/">Gallery</a></li><li><a class="tocitem" href="../benchmark/">Benchmarks</a></li><li><a class="tocitem" href="../internal/">API Reference</a></li><li><a class="tocitem" href="../contributing/">Contributing</a></li><li><a class="tocitem" href="../log/">FAQ</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>User Guide</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>User Guide</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/henry2004y/Vlasiator.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/henry2004y/Vlasiator.jl/blob/master/docs/src/manual.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Manual"><a class="docs-heading-anchor" href="#Manual">Manual</a><a id="Manual-1"></a><a class="docs-heading-anchor-permalink" href="#Manual" title="Permalink"></a></h1><p>Here we demonstrate some basic usages of processing Vlasiator output. A quick self-contained <a href="https://github.com/henry2004y/Vlasiator.jl/tree/master/examples/demo_pluto.jl">demo</a> is shown with <a href="https://plutojl.org/">Pluto</a>. For complete description of the arguments, please refer to the <a href="../internal/">API</a> documents or type <code>?function_name</code> to display help message in the REPL.</p><h2 id="Common-physical-constants"><a class="docs-heading-anchor" href="#Common-physical-constants">Common physical constants</a><a id="Common-physical-constants-1"></a><a class="docs-heading-anchor-permalink" href="#Common-physical-constants" title="Permalink"></a></h2><p>A bunch of physical constants are predefined in <a href="https://github.com/henry2004y/Vlasiator.jl/blob/master/src/vlsv/vlsvvariables.jl">Vlasiator.jl</a>. To use them, you need to import explicitly, e.g. <code>using Vlasiator: RE</code> or prepend the module name like <code>Vlasiator.RE</code>.</p><table><tr><th style="text-align: center">Physical constant</th><th style="text-align: center">Value</th><th style="text-align: left">Meaning</th></tr><tr><td style="text-align: center">qₑ</td><td style="text-align: center">-1.60217662e-19</td><td style="text-align: left">electron charge, [C]</td></tr><tr><td style="text-align: center">mₑ</td><td style="text-align: center">9.10938356e-31</td><td style="text-align: left">electron mass, [kg]</td></tr><tr><td style="text-align: center">qᵢ</td><td style="text-align: center">1.60217662e-19</td><td style="text-align: left">proton mass, [C]</td></tr><tr><td style="text-align: center">mᵢ</td><td style="text-align: center">1.673557546e-27</td><td style="text-align: left">proton mass, [kg]</td></tr><tr><td style="text-align: center">c</td><td style="text-align: center">299792458.</td><td style="text-align: left">speed of light, [m/s]</td></tr><tr><td style="text-align: center">μ₀</td><td style="text-align: center">4π*1e-7</td><td style="text-align: left">Vacuum permeability, [H/m]</td></tr><tr><td style="text-align: center">ϵ₀</td><td style="text-align: center">1/(c^2*μ₀)</td><td style="text-align: left">Vacuum permittivity, [F/m]</td></tr><tr><td style="text-align: center">kB</td><td style="text-align: center">1.38064852e-23</td><td style="text-align: left">Boltzmann constant, [m²kg/(s²K)]</td></tr><tr><td style="text-align: center">RE</td><td style="text-align: center">6.371e6</td><td style="text-align: left">Earth radius, [m]</td></tr></table><h2 id="Loading-VLSV-data"><a class="docs-heading-anchor" href="#Loading-VLSV-data">Loading VLSV data</a><a id="Loading-VLSV-data-1"></a><a class="docs-heading-anchor-permalink" href="#Loading-VLSV-data" title="Permalink"></a></h2><p>A quick way to obtain small test data can be found in <a href="../log/#Test-Data">F&amp;Q</a>. Larger open-access data can be found from the references in <a href="https://www.helsinki.fi/en/researchgroups/vlasiator/publications-and-presentations">Vlasiator publications</a>, e.g. <a href="https://a3s.fi/swift/v1/AUTH_81f1cd490d494224880ea77e4f98490d/vlasiator-2d-afc/">Takahashi+ 2020</a>. In this tutorial we are using the 2D test file <code>bulk.2d.vlsv</code> from <a href="https://github.com/henry2004y/vlsv_data">vlsv_data</a> if not specified.</p><ul><li>Read meta data</li></ul><pre><code class="language-julia hljs">file = &quot;bulk.2d.vlsv&quot;
meta = load(file)</code></pre><p>The VLSV meta data contains information of file name, variable names, ordinary cell ID list, mesh sizes, species, and velocity cell structures. It is often the first argument for methods defined in Vlasiator.jl.</p><ul><li>Read parameter</li></ul><p>For convenience we support the do-block syntax that automatically closes the file stream.</p><pre><code class="language-julia hljs">t = load(file) do meta
   readparameter(meta, &quot;time&quot;)
end</code></pre><ul><li>Read variable meta data</li></ul><pre><code class="language-julia hljs">readvariablemeta(meta, &quot;proton/vg_rho&quot;)</code></pre><p>A list of utility functions has been implemented for checking variable status. See <a href="../internal/#Vlasiator.hasname-Tuple{Any, Any, Any}">here</a> for the full list.</p><ul><li>Read variable</li></ul><pre><code class="language-julia hljs">data = meta[&quot;CellID&quot;]
# Or equivalently
data = readvariable(meta, &quot;CellID&quot;)</code></pre><p>The variable reading is designed for cells, which takes cell ID(s) as the 3rd argument if specified. The same interface works for both <a href="https://github.com/fmihpc/dccrg">DCCRG</a> grid (for storing cell centered quantities like plasma moments) and <a href="https://github.com/fmihpc/fsgrid">FS</a> grid (for storing field solver related quantities on a uniform high resolution mesh) variables. By default the returned DCCRG variable array is sorted by cell IDs. If in any case you want the original unsorted version as being stored in the file, use <code>readvariable(meta, var, false)</code>.</p><ul><li>Get variable at a given location</li></ul><pre><code class="language-julia hljs">loc = [2.0, 0.0, 0.0]
id = getcell(meta, loc)
readvariable(meta, &quot;CellID&quot;, id)</code></pre><ul><li>Get variable along a line between two points</li></ul><pre><code class="language-julia hljs">using Vlasiator: RE # Earth radii
point1 = [12RE, 0, 0]
point2 = [15RE, 0, 0]
cellids, distances, coords = getcellinline(meta, point1, point2)
var_extract = readvariable(meta, &quot;VA&quot;, cellids)</code></pre><ul><li>Extract variable at a static cell ID from a sequence of files under the same grid</li></ul><pre><code class="language-julia hljs">files = [&quot;bulk.2d.vlsv&quot;]
var = &quot;CellID&quot;
id = 1
extractsat(files, var, id)</code></pre><ul><li>Downsample field solver variable to DCCRG grid</li></ul><pre><code class="language-julia hljs">Vlasiator.downsample_fg(meta, &quot;fg_e&quot;)</code></pre><ul><li>Upsample DCCRG variable to field solver grid</li></ul><pre><code class="language-julia hljs">data = Vlasiator.read_variable_as_fg(meta, &quot;proton/vg_rho&quot;)
# Equivalent to the above, but faster
data = let
   tmp = Vlasiator.fillmesh(meta, [&quot;proton/vg_rho&quot;]; maxamronly=true)[1][1][1]
   reshape(tmp, size(tmp)[2:end])
end</code></pre><p>This is useful when corresponding DCCRG variables are not saved, or a uniform mesh is required for further analysis.</p><ul><li>Compare VLSV files</li></ul><p>One may want to check if two vlsv files are identical. This is tricky because</p><ol><li>the structure of VLSV format does not guarantee the writing order in parallel processing;</li><li>numerical error accumulates with floating point representation, especially with fastmath option.</li></ol><p>The <code>issame</code> method does not check quantities that are related to the MPI writing sequence: for some reasons, even file sizes may vary depending on the number of MPI processes!</p><pre><code class="language-julia hljs">issame(file1, file2)</code></pre><p>There is an optional third argument to <code>issame</code> for setting the relative difference tolerance, with default being 1e-4. In practice relative difference works better for &quot;large&quot; numbers, and absolute difference works better for &quot;small&quot; numbers.</p><h2 id="Computing-derived-quantities"><a class="docs-heading-anchor" href="#Computing-derived-quantities">Computing derived quantities</a><a id="Computing-derived-quantities-1"></a><a class="docs-heading-anchor-permalink" href="#Computing-derived-quantities" title="Permalink"></a></h2><p>Vlasiator.jl is capable of computing plasma moments and some predefined derived quantities and saving them directly into VLSV files. To avoid confusion about variable names, the conventions are</p><ul><li>raw quantities are all lowercases;</li><li>all predefined derived variable names start with a capital letter;</li><li>exceptions are for aliases (e.g. <code>&quot;n&quot;</code>).</li></ul><p>To obtain a derived quantity, use either a key of string or symbol,</p><pre><code class="language-julia hljs">beta = meta[&quot;Beta&quot;]
VA = meta[:VA]</code></pre><p>Here is a full list of available quantities<sup class="footnote-reference"><a id="citeref-1" href="#footnote-1">[1]</a></sup>:</p><table><tr><th style="text-align: right">Derived variable name</th><th style="text-align: right">Meaning</th><th style="text-align: right">Required variable<sup class="footnote-reference"><a id="citeref-2" href="#footnote-2">[2]</a></sup></th></tr><tr><td style="text-align: right">Bmag</td><td style="text-align: right">magnetic field magnitude</td><td style="text-align: right">vg_b_vol</td></tr><tr><td style="text-align: right">Emag</td><td style="text-align: right">electric field magnitude</td><td style="text-align: right">vg_e_vol</td></tr><tr><td style="text-align: right">Vmag</td><td style="text-align: right">bulk speed</td><td style="text-align: right">vg_v</td></tr><tr><td style="text-align: right">Bhat</td><td style="text-align: right">unit magnetic field</td><td style="text-align: right">vg_b_vol</td></tr><tr><td style="text-align: right">VS</td><td style="text-align: right">sound speed</td><td style="text-align: right">vg_ptensor_diagonal; vg_rho</td></tr><tr><td style="text-align: right">VA</td><td style="text-align: right">Alfvén speed</td><td style="text-align: right">vg_rho; Bmag</td></tr><tr><td style="text-align: right">MA</td><td style="text-align: right">Alfvén Mach number</td><td style="text-align: right">Vmag; VA</td></tr><tr><td style="text-align: right">MS</td><td style="text-align: right">Sonic Mach number</td><td style="text-align: right">Vmag; VS</td></tr><tr><td style="text-align: right">Epar</td><td style="text-align: right"><span>$\mathbf{E}_\parallel$</span></td><td style="text-align: right">vg_e_vol; Bhat</td></tr><tr><td style="text-align: right">Eperp</td><td style="text-align: right"><span>$\mathbf{E}_\perp$</span></td><td style="text-align: right">vg_e_vol; Bhat</td></tr><tr><td style="text-align: right">Vpar</td><td style="text-align: right">bulk velocity <span>$\parallel\mathbf{B}$</span></td><td style="text-align: right">vg_v; vg_b_vol</td></tr><tr><td style="text-align: right">Vperp</td><td style="text-align: right">bulk velocity <span>$\perp \mathbf{B}$</span></td><td style="text-align: right">vg_v; vg_b_vol</td></tr><tr><td style="text-align: right">Vth</td><td style="text-align: right">proton thermal velocity</td><td style="text-align: right">P; vg_rho</td></tr><tr><td style="text-align: right">P</td><td style="text-align: right">scalar thermal pressure</td><td style="text-align: right">vg_ptensor_diagonal</td></tr><tr><td style="text-align: right">Ppar</td><td style="text-align: right">pressure <span>$\parallel\mathbf{B}$</span></td><td style="text-align: right">vg_ptensor_diagonal; vg_b_vol</td></tr><tr><td style="text-align: right">Pperp</td><td style="text-align: right">pressure <span>$\perp \mathbf{B}$</span></td><td style="text-align: right">vg_ptensor_offdiagonal; vg_b_vol</td></tr><tr><td style="text-align: right">T</td><td style="text-align: right">scalar temperature</td><td style="text-align: right">P; vg_rho</td></tr><tr><td style="text-align: right">Tpar</td><td style="text-align: right">temperature <span>$\parallel\mathbf{B}$</span></td><td style="text-align: right">vg_rho; vg_ptensor_diagonal; vg_b_vol</td></tr><tr><td style="text-align: right">Tperp</td><td style="text-align: right">temperature <span>$\perp \mathbf{B}$</span></td><td style="text-align: right">vg_rho; vg_ptensor_offdiagonal; vg_b_vol</td></tr><tr><td style="text-align: right">Tanisotropy</td><td style="text-align: right"><span>$T_\perp / T_\parallel$</span></td><td style="text-align: right">Tpar; Tperp</td></tr><tr><td style="text-align: right">J</td><td style="text-align: right">current density</td><td style="text-align: right">vg_b_vol</td></tr><tr><td style="text-align: right">Jpar</td><td style="text-align: right"><span>$j_\parallel$</span></td><td style="text-align: right">vg_b_vol</td></tr><tr><td style="text-align: right">Jperp</td><td style="text-align: right"><span>$j_\perp$</span></td><td style="text-align: right">vg_b_vol</td></tr><tr><td style="text-align: right">Protated</td><td style="text-align: right">pressure tensor with <span>$\widehat{z} \parallel \mathbf{B}$</span></td><td style="text-align: right">vg_b_vol; vg_ptensor_diagonal; vg_ptensor_offdiagonal</td></tr><tr><td style="text-align: right">Panisotropy</td><td style="text-align: right"><span>$P_\perp / P_\parallel$</span></td><td style="text-align: right">ptensor; B</td></tr><tr><td style="text-align: right">Pram</td><td style="text-align: right">dynamic ram pressure</td><td style="text-align: right">vg_rho; Vmag</td></tr><tr><td style="text-align: right">Pb</td><td style="text-align: right">magnetic pressure</td><td style="text-align: right">vg_b_vol</td></tr><tr><td style="text-align: right">Poynting</td><td style="text-align: right">Poynting flux</td><td style="text-align: right">E; B</td></tr><tr><td style="text-align: right">Beta</td><td style="text-align: right">plasma <span>$\beta$</span>, <span>$P / P_B$</span></td><td style="text-align: right">P; vg_b_vol</td></tr><tr><td style="text-align: right">BetaStar</td><td style="text-align: right">modified <span>$\beta$</span>, <span>$(P+P_{ram})/P_B$</span></td><td style="text-align: right">P; Pram; vg_b_vol</td></tr><tr><td style="text-align: right">IonInertial</td><td style="text-align: right">proton inertial length</td><td style="text-align: right">vg_rho</td></tr><tr><td style="text-align: right">Larmor</td><td style="text-align: right">proton Larmor radius</td><td style="text-align: right">Vth; Bmag</td></tr><tr><td style="text-align: right">Gyroperiod</td><td style="text-align: right">proton gyroperiod</td><td style="text-align: right">Bmag</td></tr><tr><td style="text-align: right">PlasmaPeriod</td><td style="text-align: right">plasma oscillation period</td><td style="text-align: right">vg_rho</td></tr><tr><td style="text-align: right">Gyrofrequency</td><td style="text-align: right">proton gyro-frequency</td><td style="text-align: right">Bmag</td></tr><tr><td style="text-align: right">Omegap</td><td style="text-align: right">plasma frequency (proton)</td><td style="text-align: right">vg_rho</td></tr><tr><td style="text-align: right">MagneticTension</td><td style="text-align: right"><a href="https://en.wikipedia.org/wiki/Magnetic_tension">magnetic tension force</a></td><td style="text-align: right">vg_b_vol</td></tr><tr><td style="text-align: right">n</td><td style="text-align: right">proton number density</td><td style="text-align: right">vg_rho</td></tr></table><p>which can also be found as keys of dictionary in <a href="https://github.com/henry2004y/Vlasiator.jl/blob/master/src/vlsv/vlsvvariables.jl">vlsvvariables.jl</a>.</p><div class="admonition is-info"><header class="admonition-header">Note</header><div class="admonition-body"><p>In Vlasiator, the cells inside the inner boundary (which is usually a sphere/circle) are filled with zero density values. This is then used to identify the inner boundary for all other quantities. Therefore, if you are manipulating directly on data, make sure that the nonsense values inside the inner boundary are excluded. One way to do this can be found in <a href="https://github.com/henry2004y/Vlasiator.jl/blob/master/src/vlsv/vlsvvariables.jl">vlsvvariables.jl</a>.</p></div></div><h3 id="Velocity-space-moments"><a class="docs-heading-anchor" href="#Velocity-space-moments">Velocity space moments</a><a id="Velocity-space-moments-1"></a><a class="docs-heading-anchor-permalink" href="#Velocity-space-moments" title="Permalink"></a></h3><p>We can also calculate plasma moments from the saved VLSV velocity space distributions.</p><pre><code class="language-julia hljs">meta = load(&quot;bulk.1d.vlsv&quot;)
cellid = 5
# VDF cell indexes and values, with sparsity
vcellids, vcellf = readvcells(meta, cellid; species=&quot;proton&quot;)

getdensity(meta, vcellf)

getvelocity(meta, vcellids, vcellf)
# pressure tensor components Pxx, Pyy, Pzz, Pyz, Pzx, Pxy
getpressure(meta, vcellids, vcellf)
# heat flux components qⱼⱼᵢ
getheatfluxvector(meta, vcellids, vcellf)</code></pre><p>To obtain the original ordering of velocity cells,</p><pre><code class="language-julia hljs">vcellids_original = Vlasiator.reorder(meta.meshes[&quot;proton&quot;], vcellids)</code></pre><p>Non-Maxwellianity represents the deviation from a Maxwellian distribution. Currently we have implemented a monitor quantity named &quot;Maxwellianity&quot;, which is defined as <span>$-ln \big[ 1/(2n) \int |f(v) - g(v)| dv \big]$</span>, where n is the density, f(vᵢ) is the actual VDF value at velocity cell i, and g(vᵢ) is the analytical Maxwellian (or strictly speaking, normal) distribution with the same density, bulk velocity and scalar pressure as f.</p><pre><code class="language-julia hljs">getmaxwellianity(meta, vcellids, vcellf)</code></pre><p>The value ranges from [0, +∞], with 0 meaning not Maxwellian-distributed at all, and +∞ a perfect Maxwellian distribution. An alternative measure is the KL-divergence borrowed from statistics, where we select the reference distribution g to be again a Maxwellian derived from the actual distribution f:</p><pre><code class="language-julia hljs">getKLdivergence(meta, vcellids, vcellf)</code></pre><p>In this case, 0 indicates perfect Maxwellian while +∞ indicates largest deviation. There is no unique definition of non-Maxwellianity, and we are still trying to see which one works better for describing plasma behaviors.</p><p>Sometimes it may be useful to recover the full 3D array of VDFs:</p><pre><code class="language-julia hljs">f = Vlasiator.reconstruct(meta.meshes[&quot;proton&quot;], vcellids, vcellf)</code></pre><p>However, usually in practice there would be only about 1% nonzero values. The moments and maxwellianity calculations above all have an alternative form of using reconstructed VDFs as inputs.</p><h2 id="Plotting"><a class="docs-heading-anchor" href="#Plotting">Plotting</a><a id="Plotting-1"></a><a class="docs-heading-anchor-permalink" href="#Plotting" title="Permalink"></a></h2><p>Vlasiator.jl does not include any plotting library as explicit dependency, but it offers plotting recipes/wrappers once the target plotting package is used.</p><p>Currently PyPlot provides the most complete and fine-tuned plotting capabilities. Plotting with PyPlot by accepting <code>MetaVLSV</code> as the first argument is supported via <a href="https://github.com/henry2004y/Vlasiator.jl/VlasiatorPyPlot"><code>VlasiatorPyPlot</code></a>. Plots is a collection of plotting libraries with a uniform frontend, but it lacks fine-tuned supports and consistent APIs between different backends. Makie, a native Julia plotting library, is also supported via package extension after Julia 1.9 and a package <a href="https://github.com/henry2004y/VlasiatorMakie.jl">VlasiatorMakie.jl</a> before Julia 1.9. Without generating an system image from <a href="https://github.com/JuliaLang/PackageCompiler.jl">PackageCompiler</a>, it would take ~20s for the first plot on Julia 1.9. However, Makie has made nice progress in layouts, widgets, docs, and all the tiny things, which makes it a strong candidate for the de facto plotting library in the future.</p><p>More <a href="../examples/#examples">examples</a> of customized plots can be found in the repository.</p><h3 id="PyPlot-Backend"><a class="docs-heading-anchor" href="#PyPlot-Backend">PyPlot Backend</a><a id="PyPlot-Backend-1"></a><a class="docs-heading-anchor-permalink" href="#PyPlot-Backend" title="Permalink"></a></h3><p>To trigger Matplotlib plotting that supports <code>MetaVLSV</code>, <code>using VlasiatorPyPlot</code>. All the functions with identical names as in Matplotlib accept all possible keyword arguments supported by Matplotlib, e.g. font width, font size, colormap, etc. For detailed adjustment of plots, please refer to the <a href="https://matplotlib.org/">Matplotlib</a> documentation for details.</p><div class="admonition is-warning"><header class="admonition-header">Warning</header><div class="admonition-body"><p>The method call to certain axes is not dispatched, e.g. <code>ax.plot</code>; as an alternative, one needs to pass <code>ax</code> as the third argument to the functions, e.g. <code>plot(meta, &quot;rho&quot;, ax)</code>. See <a href="https://aaltoscicomp.github.io/python-for-scicomp/data-visualization/#matplotlib-has-two-different-interfaces">Matplotlib&#39;s two interfaces</a> for the history of the interfaces.</p></div></div><ul><li>Scalar colored contour from 2D simulation</li></ul><pre><code class="language-julia hljs">pcolormesh(meta, &quot;n&quot;)</code></pre><ul><li>Vector z-component colored contour from 2D simulation in a manually set range</li></ul><pre><code class="language-julia hljs">pcolormesh(meta, &quot;n&quot;, comp=:z, colorscale=Log, axisunit=EARTH, vmin=1e6, vmax=2e6)</code></pre><ul><li>Vz colored contour from 2D simulation with prescribed colormap</li></ul><pre><code class="language-julia hljs">pcolormesh(meta, &quot;proton/vg_v&quot;, comp=:z, colorscale=Linear, cmap=matplotlib.cm.RdBu_r)</code></pre><ul><li>Derived quantity colored contour from 2D simulation (as long as the input variable is in the predefined dictionary)</li></ul><pre><code class="language-julia hljs">pcolormesh(meta, &quot;Bmag&quot;, comp=:z, colorscale=Linear, axisunit=SI)</code></pre><ul><li>Streamline from 2D simulation</li></ul><pre><code class="language-julia hljs">streamplot(meta, &quot;proton/vg_v&quot;, comp=&quot;xy&quot;)</code></pre><ul><li>Quiver from 2D simulation</li></ul><pre><code class="language-julia hljs">quiver(meta, &quot;proton/vg_v&quot;, comp=&quot;xy&quot;)</code></pre><p>The <code>comp</code> option is used to specify the two vector components.</p><p>You can choose to use a linear/log/symlog color scale by setting keyword <code>colorscale</code> to <code>Linear</code>, <code>Log</code>, or <code>SymLog</code>, plot vector components by setting keyword <code>op</code> to <code>:x</code>, <code>:y</code>, <code>:z</code>, <code>1</code>, <code>2</code>, <code>3</code>, <code>0</code> or <code>:mag</code>, and set <code>axisunit</code> to <code>EARTH</code> or <code>SI</code> etc.</p><ul><li>Mesh denoted by cell centers</li></ul><pre><code class="language-julia hljs">plotmesh(meta; projection=&quot;z&quot;, color=&quot;k&quot;)</code></pre><ul><li>Cut slice colored contour from 3D simulation</li></ul><pre><code class="language-julia hljs">meta = load(&quot;bulk.amr.vlsv&quot;)
pcolormesh(meta, &quot;proton/vg_rho&quot;, normal=:y, origin=0.0)</code></pre><ul><li>Velocity distribution slice plot near a given spatial location</li></ul><pre><code class="language-julia hljs">meta = load(&quot;bulk.1d.vlsv&quot;)
coordinates = [0.0, 0.0, 0.0]
vdfslice(meta, coordinates)</code></pre><ul><li>Quick interactive REPL-based function for data inspection</li></ul><pre><code class="language-julia hljs">pui(meta)</code></pre><p>Or pass filename directly like <code>pui(file)</code>.</p><div class="admonition is-info"><header class="admonition-header">Note</header><div class="admonition-body"><p>This is an experimental feature. We plan to have GUI-based plotting support in the future.</p></div></div><p>For a full list available optional arguments, please refer to the <a href="../internal/#Public-APIs">doc for each method</a></p><h3 id="Plots-Backend"><a class="docs-heading-anchor" href="#Plots-Backend">Plots Backend</a><a id="Plots-Backend-1"></a><a class="docs-heading-anchor-permalink" href="#Plots-Backend" title="Permalink"></a></h3><p>To trigger Plots.jl plotting, <code>using Plots</code>. This backend supports all available attributes provided by <a href="http://docs.juliaplots.org/latest/">Plots.jl</a>. By default it uses <a href="https://gr-framework.org/">GR</a>, but many other plotting libraries are also supported.</p><ul><li>Scaler colored contour from 2D simulation</li></ul><pre><code class="language-julia hljs">var = &quot;n&quot;
heatmap(meta, var, aspect_ratio=:equal, c=:turbo)</code></pre><ul><li>Scaler colored contour with lines from 2D simulation</li></ul><pre><code class="language-julia hljs">var = &quot;n&quot;
contourf(meta, var)</code></pre><ul><li>VDF projected slice in a normal direction</li></ul><pre><code class="language-julia hljs">meta = load(&quot;bulk.1d.vlsv&quot;)
location = [0.0, 0.0, 0.0]
vdfslice(meta, location)</code></pre><h3 id="Makie-Backend"><a class="docs-heading-anchor" href="#Makie-Backend">Makie Backend</a><a id="Makie-Backend-1"></a><a class="docs-heading-anchor-permalink" href="#Makie-Backend" title="Permalink"></a></h3><p>Makie plotting is supported via package extension after Julia 1.9. The extension is automatically loaded when both <code>Vlasiator</code> and one of the Makie backends (e.g. <code>GLMakie</code>, <code>CairoMakie</code>). Before Julia 1.9, a standalone package <a href="https://github.com/henry2004y/VlasiatorMakie.jl">VlasiatorMakie.jl</a> is designed for plotting with Makie. To trigger Makie plotting with OpenGL, <code>using VlasiatorMakie, GLMakie</code>.</p><p>You can either use intrinsic Makie plotting methods like</p><pre><code class="language-julia hljs">lines(meta, var)   # 1D
heatmap(meta, var) # 2D</code></pre><p>or use full recipes for quick inspection of data</p><ul><li>2D slices of 3D AMR data</li></ul><pre><code class="language-julia hljs">vlslice(meta, var; normal=:x)</code></pre><ul><li>Orthognal slices of 3D AMR data</li></ul><pre><code class="language-julia hljs">vlslices(meta, var)</code></pre><ul><li>2D slice of VDFs at a spatial cell</li></ul><pre><code class="language-julia hljs">fig, ax = vdfslice(meta, location)
fig</code></pre><ul><li>Orthognal slices of VDFs at a spatial cell</li></ul><pre><code class="language-julia hljs">vdfslices(meta, location)</code></pre><ul><li>3D scatter of VDFs at a spatial cell</li></ul><pre><code class="language-julia hljs">fig, ax = vdfvolume(meta, location)
fig</code></pre><p>The interactive plots are available through the OpenGL backend of Makie <code>GLMakie</code>. For noninteractive high fidelity plots, we can also use the Cairo backend of Makie <code>CairoMakie</code>. Other options can be found at <a href="https://makie.juliaplots.org/stable/#makie_ecosystem">Makie Ecosystem</a>.</p><pre><code class="language-julia hljs">using Vlasiator, GLMakie

file = &quot;bulk.2d.vlsv&quot;
meta = load(file)

heatmap(meta, &quot;proton/vg_rho&quot;)</code></pre><p>3D isosurface:</p><pre><code class="language-julia hljs">fig = volume(meta, &quot;fg_b&quot;, EARTH, 3; algorithm=:iso, isovalue=0.0, isorange=1e-9)</code></pre><p>Single figure contour plot:</p><pre><code class="language-julia hljs">fig = Figure(size=(700, 600), fontsize=18)
ga = fig[1,1] = GridLayout()
ax = Axis(fig[1,1],
   aspect = DataAspect(),
   title = &quot;t = $(round(meta.time, digits=1))s&quot;,
   xlabel = L&quot;x [$R_E$]&quot;,
   ylabel = L&quot;y [$R_E$]&quot;
)
hmap = heatmap!(meta, &quot;proton/vg_rho&quot;, colormap=:turbo)
cbar = Colorbar(fig, hmap, label=L&quot;$\rho$ [amu/cc]&quot;, width=13,
                ticksize=13, tickalign=1, height=Relative(1))
fig[1,2] = cbar
colgap!(ga, 1)</code></pre><p>Multi-figure contour plots:</p><pre><code class="language-julia hljs">fig = Figure(size=(1100, 800), fontsize=18)

axes = []
v_str = [&quot;CellID&quot;, &quot;proton/vg_rho&quot;, &quot;proton/vg_v&quot;,
   &quot;vg_pressure&quot;, &quot;vg_b_vol&quot;, &quot;vg_e_vol&quot;]
c_str = [&quot;&quot;, L&quot;$\rho$ [amu/cc]&quot;, &quot;[m/s]&quot;, &quot;[Pa]&quot;, &quot;[T]&quot;, &quot;[V/m]&quot;]
c = 1

for i in 1:2, j in 1:2:5
   ax = Axis(fig[i,j], aspect=DataAspect(),
      xgridvisible=false, ygridvisible=false,
      title = v_str[c],
      xlabel = L&quot;x [$R_E$]&quot;,
      ylabel = L&quot;y [$R_E$]&quot;)
   hmap = heatmap!(meta, v_str[c], colormap=:turbo)
   cbar = Colorbar(fig, hmap, label=c_str[c], width=13,
                ticksize=13, tickalign=1, height=Relative(1))
   fig[i, j+1] = cbar
   c += 1
   push!(axes, ax) # just in case you need them later.
end

fig[0, :] = Label(fig, &quot;t = $(round(meta.time, digits=1))s&quot;)</code></pre><p>Adjusting axis limits:</p><pre><code class="language-julia hljs">location = [0, 0, 0]
fig = vdfslice(meta, location)
xlims!(fig.content[1], -1000, 1000)
ylims!(fig.content[1], -1000, 1000)
limits!(fig.content[1], 0, 10, 0, 10) # xmin, xmax, ymin, ymax</code></pre><p>Saving figure:</p><pre><code class="language-julia hljs">fig = vdfvolume(meta, location)
save(&quot;output.png&quot;, fig)</code></pre><p>The resolution is a property of the Figure object returned from the function.</p><h2 id="Appending-to-VLSV"><a class="docs-heading-anchor" href="#Appending-to-VLSV">Appending to VLSV</a><a id="Appending-to-VLSV-1"></a><a class="docs-heading-anchor-permalink" href="#Appending-to-VLSV" title="Permalink"></a></h2><p>We are able to compute derived quantities from an original VLSV file and generate a new VLSV output with new quantities included.</p><pre><code class="language-julia hljs">meta = load(&quot;bulk.1d.vlsv&quot;)
vmag = readvariable(meta, &quot;Vmag&quot;)
pa = readvariable(meta, &quot;Panisotropy&quot;)
vars = Vector{Tuple{VecOrMat, String, VarInfo}}(undef, 0)
using LaTeXStrings
push!(vars, (vmag, &quot;vmag&quot;, VarInfo(&quot;m/s&quot;, L&quot;$\mathrm{m}/mathrm{s}$&quot;, L&quot;$V$&quot;, &quot;&quot;)))
push!(vars, (pa, &quot;panisotropy&quot;, VarInfo(&quot;&quot;, &quot;&quot;, &quot;&quot;, &quot;&quot;)))

write_vlsv(&quot;bulk.1d.vlsv&quot;, &quot;bulk.1d_new.vlsv&quot;, vars)</code></pre><div class="admonition is-info"><header class="admonition-header">Note</header><div class="admonition-body"><p>Writing new FsGrid variables is not supported. All quantities from the original file is maintained.</p></div></div><h2 id="Converting-to-VTK"><a class="docs-heading-anchor" href="#Converting-to-VTK">Converting to VTK</a><a id="Converting-to-VTK-1"></a><a class="docs-heading-anchor-permalink" href="#Converting-to-VTK" title="Permalink"></a></h2><p>We can convert VLSV files into VTK format. Since DCCRG is Cartesian based with uniform spacing, each level of mesh refinement corresponds to a VTK image file, and the cell refinement relationships are stored in <code>vtkGhostType</code> as well as the <code>vthb</code> file.</p><p>To convert a VLSV file into VTK,</p><pre><code class="language-julia hljs">write_vtk(file)</code></pre><p>This function accepts either string of file names or <code>MetaVLSV</code>.</p><p>To see the full list of options, please refer to the documentation in <a href="../internal/">API Reference</a>. Example usage can be found <a href="../examples/postprocess/demo_convert2vti/#demo_convertvtk">here</a>.</p><div class="admonition is-warning"><header class="admonition-header">Warning</header><div class="admonition-body"><p>As of ParaView 5.9.1, there are <a href="https://discourse.paraview.org/t/vthb-file-structure/7224">display issues</a> with <code>VTKOverlappingAMR</code>. However, we can read the generated image files directly. There is also an keyword argument for <code>write_vtk</code> called <code>maxamronly</code>: when it is set to <code>true</code>, then only the image file at the highest refinement level is generated. This part is experimental and subject to change in the future.</p></div></div><h2 id="Tracking-log-files"><a class="docs-heading-anchor" href="#Tracking-log-files">Tracking log files</a><a id="Tracking-log-files-1"></a><a class="docs-heading-anchor-permalink" href="#Tracking-log-files" title="Permalink"></a></h2><p>The runtime performance per iteration can be monitored through log files:</p><pre><code class="language-julia hljs">file = &quot;logfile.txt&quot;
timestamps, speed = readlog(file)</code></pre><p>Here is a live <a href="../examples/postprocess/demo_log/#demo_log">demo</a>.</p><h2 id="Examples"><a class="docs-heading-anchor" href="#Examples">Examples</a><a id="Examples-1"></a><a class="docs-heading-anchor-permalink" href="#Examples" title="Permalink"></a></h2><p>More <a href="../examples/#examples">examples</a> are provided about</p><ul><li>Plotting with PyPlot</li><li>Plotting with Plots</li><li>Extracing variable along a line</li><li>Field line tracing</li><li>Simulation log file tracking</li><li>Converting VLSV to VTK format</li><li>Parallel post-processing</li><li>Finding X-points and O-points in 2D reconnections</li></ul><p>Feel free to check those out and try on your data!</p><section class="footnotes is-size-7"><ul><li class="footnote" id="footnote-1"><a class="tag is-link" href="#citeref-1">1</a>For species specific variables, you need to add the species name at the front, separated by a slash. For example, the proton bulk velocity is a string <code>proton/vg_v</code>.</li><li class="footnote" id="footnote-2"><a class="tag is-link" href="#citeref-2">2</a>If a required variable exists in the VLSV file, we try to use it directly instead of calculating from other variables. The interpolated FS grid variables onto DCCRG grid are preferred over original FS grid variables.</li></ul></section></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../">« Home</a><a class="docs-footer-nextpage" href="../examples/">Examples »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.4.1 on <span class="colophon-date" title="Saturday 8 June 2024 17:46">Saturday 8 June 2024</span>. Using Julia version 1.10.4.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
